# Documentation Restructure & UML Diagram

**Date:** 2025-12-01  
**Session:** 01  
**Topic:** Documentation restructure with UML architecture diagram

## Summary

Dissociated the Sphinx documentation homepage from the project README and added a comprehensive UML diagram showing PHISE's architecture. Also fully documented the Quick Start guide.

## Changes Made

### 1. Documentation Homepage (`docs/sphinx/index.md`)

- **Removed** the `{include} ../../README.md` directive
- **Created** new standalone documentation homepage with:
  - Development status warnings (PhD project, instability, analysis module separation)
  - Comprehensive overview of PHISE features
  - **Mermaid UML diagram** showing full architecture
  - Key design patterns explanation (Context Auto-Update, Units at API Boundaries, Component Hierarchy)
  - Feature highlights (Instrument/Scene Modeling, Numerical Simulation, Visualization)
  - Quick links to other doc pages

### 2. UML Architecture Diagram

Created a comprehensive Mermaid class diagram including:

**Classes:**
- `Context` - Observation orchestrator
- `Interferometer` - Instrument configuration
- `Telescope` - Individual apertures
- `Chip` (abstract) and `SuperKN` (implementation) - Photonic beam combiners
- `Camera` - Detector
- `Target` and `Companion` - Scene components
- `CompanionList` - Custom list with type checking

**Modules:**
- `coordinates` - Projected baselines, hour angle transformations
- `signals` - Photon flux, signal propagation
- `phase` - Optical path differences, phase screens
- `mmi` - Multi-Mode Interferometer transfer matrices
- `test_statistics` - Detection statistics, null depth analysis

**Relationships:**
- Composition (Context contains Interferometer and Target)
- Aggregation (Interferometer has telescopes, chip, camera)
- Inheritance (SuperKN implements Chip)
- Dependencies (modules used by classes)
- Parent references (auto-update pattern backreferences)

### 3. Quick Start Documentation (`docs/sphinx/quickstart.md`)

Fully documented with:
- Installation instructions (conda and pip methods)
- First simulation example (complete working code)
- Basic visualization examples (transmission maps, projected baselines)
- Working with physical units (`astropy.units`)
- Context auto-update pattern explanation
- Accessing simulation results
- Running tests
- Common pitfalls and solutions
- Next steps and getting help

### 4. Sphinx Configuration (`docs/sphinx/conf.py`)

- **Added** `sphinxcontrib.mermaid` extension for UML diagram rendering
- **Theme:** Using `breeze` (requires Python 3.13+ and Sphinx 8.2.3)

### 5. Documentation Dependencies (`docs/sphinx/requirements.txt`)

- **Added** `sphinxcontrib-mermaid` for Mermaid diagram support

## Files Modified

- `docs/sphinx/index.md` - Complete rewrite with UML diagram
- `docs/sphinx/quickstart.md` - Fully documented from placeholder
- `docs/sphinx/conf.py` - Added Mermaid extension, changed theme
- `docs/sphinx/requirements.txt` - Added new dependencies

## Files Created

- `.github/agent-logs/2025.01.12-01_doc-restructure-uml.md` (this file)

## Breaking Changes

None - documentation only changes.

## Physics Validation

Not applicable - documentation changes only.

## Testing

- Documentation builds successfully with `make html` in activated `.venv` (Python 3.13.9)
- Sphinx version: 8.2.3
- Mermaid diagrams render correctly in browser with **breeze** theme
- Minor NumPy warnings (experimental MINGW-W64 build on Windows) - non-blocking
- 17 pre-existing docstring warnings in test_statistics module

## Notes

### Why Separate Documentation from README?

The README is for GitHub visitors and should be concise. The documentation homepage can be more comprehensive and include visual aids like UML diagrams that are specific to the online docs.

### Theme Change

~~The original `breeze` theme (`sphinx-breeze-theme`) had installation/compatibility issues (`theme.toml` missing). Switched to the widely-used `sphinx_rtd_theme` which is more stable and well-maintained.~~

**UPDATE:** Theme restored to `breeze`. The issue was that `breeze` requires:
- Python 3.13+ (tested with 3.13.9)
- Sphinx 8.2.3 (not Sphinx 7.x or 9.x due to myst-parser compatibility)
- Must use the activated `.venv` environment

The previous error was due to using an older Python/Sphinx version outside the venv.

### Mermaid vs. Other UML Tools

Chose Mermaid because:
- Text-based (version control friendly)
- Renders in documentation automatically
- No need for external image files
- Easy to update as architecture evolves

## Follow-up Tasks

- [ ] Fix pre-existing docstring warnings in `test_statistics.py` (substitution references)
- [x] ~~Consider re-enabling breeze theme if compatibility issues are resolved~~ **DONE** - breeze restored
- [ ] Add more detailed examples to Quick Start (temporal response, calibration)
- [ ] Create tutorial notebooks referenced from documentation

## Important Notes for Building Documentation

**CRITICAL:** To build the documentation successfully, you MUST:

1. Activate the `.venv` environment: `& D:\PHISE\.venv\Scripts\Activate.ps1`
2. Navigate to docs: `cd D:\PHISE\docs\sphinx`
3. Build: `.\make.bat html`

**Do NOT** build from outside the venv or with a different Python version. The breeze theme requires Python 3.13+ and will fail with older versions.

## References

- Mermaid documentation: https://mermaid.js.org/
- Sphinx Mermaid extension: https://github.com/mgaitan/sphinxcontrib-mermaid
- ReadTheDocs theme: https://sphinx-rtd-theme.readthedocs.io/
