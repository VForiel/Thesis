# Fix: shallow copy corruption in distribution functions

Date: 2026-01-07

## Problem
When calling `instant_distribution` followed by `verify_distributions` in the notebook, kernels 2 and 3 showed corrupted numerical distributions (flat/dispersed) while analytical distributions were correct.

## Root Cause
The functions used `copy()` (shallow copy) instead of `deepcopy()` when duplicating contexts. This caused shared references to nested objects like `target.companions[0]`. When `ctx_po.target.companions[0].c *= scale` was executed (multiplying contrast by 1e12), it corrupted the same companion object in all three contexts (`ctx`, `ctx_so`, `ctx_po`).

## Solution
- Replaced `from copy import deepcopy as copy` with `from copy import deepcopy`
- Changed all `copy(ctx)` calls to `deepcopy(ctx)` in:
  - `instant_distribution` (lines ~133, 138, 141)
  - `time_evolution` (lines ~561, 566, 569)
- Updated notebook to reinitialize context before `verify_distributions` call as a safeguard

## Files Modified
- THESIS/src/analysis/data_representations/data_representations.py
- THESIS/analysis/data_representations.ipynb

## Testing
User should re-run the verification cell to confirm kernel 2 and 3 distributions are now correct.
