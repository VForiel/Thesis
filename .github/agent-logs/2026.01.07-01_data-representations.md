# Notebook Fix: data_representations.ipynb

Date: 2026-01-07

## Summary
- Fixed import path error for `analysis.data_representations` by robustly adding `src` to `sys.path` and importing `analysis.data_representations`.
- Corrected LaTeX equations in markdown cells:
  - Instant distribution hypothesis: `$\Delta\,\mathrm{OPD} \sim \mathcal{N}(0, \Gamma^2)$`.
  - Detection signal relation: `$K(\alpha,\delta) = K_{\star} + K_{\mathrm{planet}} \approx K_{\mathrm{planet}}$`.
- Re-implemented local time evolution loop in the notebook to avoid API shape bug when passing `upstream_pistons` (2D) into `Context.observe`.
- Validated execution of all cells: configuration, instant distribution, time evolution, and statistics.

## Files Modified
- THESIS/analysis/data_representations.ipynb
  - Edited import cell to handle `src` path resolution.
  - Edited markdown cells to fix LaTeX.
  - Replaced `data_representations.time_evolution(...)` call with a local implementation that:
    - Iterates over hour-angle range
    - Draws `n` piston realizations per angle
    - Applies `np.median` per kernel over `n`

## Tests / Validation
- Executed notebook cells via kernel `Python 3.12.10 (.venv)`:
  - Instant distribution: produced synchronized plots and console outputs.
  - Time evolution: computed `data_time` with shape `(96, 3)`; no errors.
  - Final statistics: printed means and std for kernels; no NaNs.

## Notes
- The underlying API `Context.observe()` expects `upstream_pistons` of shape `(n_telescopes,)`. Passing an array of shape `(n, n_telescopes)` triggers a broadcast error inside `observe_monochromatic`. The notebook workaround avoids modifying library code.
- If desired, consider updating `analysis.data_representations.time_evolution()` to loop over `n` realizations per hour angle.
